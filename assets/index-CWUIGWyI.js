(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();const s={cards:document.querySelectorAll(".card"),backBtn:document.querySelector(".back"),renderDetailInfo(e){this.cards.forEach(o=>{o!==e&&o.classList.add("hidden")}),e.classList.add("selected"),this.backBtn.style.display="flex"},deleteDetailInfo(){this.cards.forEach(e=>{e.classList.remove("hidden"),e.classList.remove("selected")}),this.backBtn.style.display="none"},renderWalletInfo(e){this.cards.forEach(o=>{var r,a;let t=null,n=31;if(o.classList.contains("eat")&&(t="eat",n=5),o.classList.contains("travel")&&(t="travel"),o.classList.contains("cash")&&(t="cash"),o.classList.contains("bank")&&(t="bank"),t){const l=((r=e[t])==null?void 0:r.money)||0,d=((a=e[t])==null?void 0:a.rate)||1,y=o.querySelector(".card__total > span"),f=o.querySelector(".card__days");y.textContent=l;const i=Math.floor(l/d);t!=="bank"&&(this.renderTemp(i,n,o),f.textContent=i<1?"0 дней":this.declensionDays(i))}})},renderTemp(e,o,t){const n=t.querySelector(".card__currentTemp"),r=Math.min(100,e/o*100);n.style.width=`${r}%`,r>=75?n.style.backgroundColor="green":r>=50?n.style.backgroundColor="yellow":r>=25?n.style.backgroundColor="orange":n.style.backgroundColor="red"},declensionDays(e){const o=e%10,t=e%100;return t>=11&&t<=19?`${e} дней`:o===1?`${e} день`:o>=2&&o<=4?`${e} дня`:`${e} дней`}},c={baseUrl:"https://new-cost-server1.onrender.com",async getWallet(){try{const e=await fetch(`${this.baseUrl}/api/wallet/`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Ошибка при получении кошелька");return await e.json()}catch(e){throw console.error("Ошибка в модели CardModel (getWallet):",e),e}},async addMoneyToCategory(e,o){try{const t=await fetch(this.baseUrl+"/api/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({category:e,amount:o})});if(!t.ok)throw new Error("Ошибка при пополнении категории");return await t.json()}catch(t){throw console.error("Ошибка в модели CardModel (addMoneyToCategory):",t),t}},async removeMoneyToCategory(e,o){try{const t=await fetch(this.baseUrl+"/api/remove",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({category:e,amount:o})});if(!t.ok)throw new Error("Ошибка при пополнении категории");return await t.json()}catch(t){throw console.error("Ошибка в модели CardModel (addMoneyToCategory):",t),t}}},u={init(){this.openDetailInfo(),this.closeDetailInfo(),this.getWalletData(),this.incrementWallet(),this.dicrementWallet()},openDetailInfo(){s.cards.forEach(e=>{e.addEventListener("click",()=>s.renderDetailInfo(e))})},closeDetailInfo(){s.backBtn.addEventListener("click",()=>s.deleteDetailInfo())},updateWalletInfo(e){s.renderWalletInfo(e)},incrementWallet(){s.cards.forEach(e=>{const o=e.querySelector(".add"),t=e.querySelector("input");o.addEventListener("click",()=>{this.addMoney(e.id,+t.value),t.value=""})})},dicrementWallet(){s.cards.forEach(e=>{const o=e.querySelector(".remove"),t=e.querySelector("input");o.addEventListener("click",()=>{this.removeMoney(e.id,+t.value),t.value=""})})},async getWalletData(){try{const e=await c.getWallet();console.log(e),this.updateWalletInfo(e)}catch(e){console.error("Ошибка в контроллере (getWalletData):",e)}},async addMoney(e,o){try{const t=await c.addMoneyToCategory(e,o);this.getWalletData()}catch(t){console.error("Ошибка в контроллере (addMoney):",t)}},async removeMoney(e,o){try{const t=await c.removeMoneyToCategory(e,o);this.getWalletData()}catch(t){console.error("Ошибка в контроллере (addMoney):",t)}}};u.init();
